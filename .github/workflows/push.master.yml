name: CI on pushing to the master branch

on:
  push:
    branches: [ master, ningaro-ci ]

jobs:
  setup_env:
    name: Setup Env 
    runs-on: self-hosted

    steps:
    - uses: actions/checkout@v2
      name: Checkout repository ğŸ›ï¸
    
    - name: Get Node & Yarn Version ğŸ”–
      run: echo node `node -v` yarn `yarn -v`
      
    - name: Install dependencies ğŸ•¸
      run: yarn install


  build:
    name: Building App
    runs-on: self-hosted
    needs: setup_env

    steps:
    - name: Build project ğŸ› 
      run: yarn build

    - name: Save Artifact ğŸ’¿
      uses: actions/upload-artifact@v2
      with:
        name: build-app
        path: build/


  deploy:
    name: Deploy
    runs-on: self-hosted
    needs: [setup_env, build]

    steps:
    - name: Clean work path ğŸ”¥
      run: sudo rm -r -f *

    - name: Download Artifact ğŸ“€
      uses: actions/download-artifact@v2
      with:
        name: build-app

    - name: Clean deploy path ğŸ”¥
      run: sudo rm -r -f /var/www/html/*
      
    - name: Deploy ğŸ‰
      run: sudo mv -f * /var/www/html
